(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{277:function(t,_,v){"use strict";v.r(_);var s=v(13),a=Object(s.a)({},(function(){var t=this,_=t._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"mysql-error-1215-cannot-add-foreign-key-constraint"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mysql-error-1215-cannot-add-foreign-key-constraint"}},[t._v("#")]),t._v(" Mysql[Error:1215] Cannot add foreign key constraint")]),t._v(" "),_("p",{attrs:{align:"right"}},[t._v("작성일 : 22.08.13")]),t._v(" "),_("ul",[_("li",[t._v("외래키 설정 추가 시에 발생하는 문제점")]),t._v(" "),_("li",[t._v("명확하게 뭐가 잘못되서 외래키를 추가할 수 없는지 표시해주지 않음.")]),t._v(" "),_("li",[t._v("여러가지 상황을 다 고려해봐야 함.")]),t._v(" "),_("li",[t._v("내 경우에는 4번과 5번이 같이 문제였음.")]),t._v(" "),_("li",[t._v("8번의 case도 생겼다. 영카트 기반으로 짜여진 DB에서 table 새로 만들었을때 innodb가 아닌 MyISAM 인 경우도 있다...")]),t._v(" "),_("li",[t._v("언어 인코딩 설정도 동일해야한다 ( ex: utf8_general_ci 와 utfmb4_general_ci 는 안된다.)")])]),t._v(" "),_("a",{attrs:{href:"https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=apple_ar&logNo=221404069733"}},[t._v("\n참고\n")]),t._v(" "),_("hr"),t._v(" "),_("details",[_("summary",[t._v("\n1) 제한사항이 참조하는 테이블 혹은 인덱스가 아직 존재하지 않는 경우(보통 덤프를 로드하는 경우)\n")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": 각 상위 테이블에 대해 SHOW TABLES 혹은 SHOW CREATE TABLE을 실행하세요. 어느 것이든 1146 오류가 난다면, 잘못된 순서로 생성하고 있다는 것을 의미합니다.")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 누락된 create table을 실행하고 나서 다시 시도해보거나 foreign-key-checks를 잠시 비활성화하세요. 특히 순환 참조가 존재할 수도 있는 데이터베이스를 백업으로 복구하는 동안 필요합니다. 다음처럼 실행하세요:")]),t._v(" "),_("p",[t._v("SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS; SET FOREIGN_KEY_CHECKS=0; SOURCE /backups/mydump.sql; -- restore your backup within THIS session SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;")]),t._v(" "),_("p",[_("strong",[t._v("예제")])]),t._v(" "),_("p",[t._v(":")]),t._v(" "),_("p",[t._v("mysql> CREATE TABLE child ( -> id INT(10) NOT NULL PRIMARY KEY, -> parent_id INT(10), -> FOREIGN KEY (parent_id) REFERENCES "),_("code",[t._v("parent")]),t._v("("),_("code",[t._v("id")]),t._v(") -> ) ENGINE INNODB; ERROR 1215 (HY000): Cannot add foreign key constraint # We check for the parent table and is not there. mysql> SHOW TABLES LIKE 'par%'; Empty set (0.00 sec) # We go ahead and create the parent table (we’ll use the same parent table structure for all other example in this blogpost): mysql> CREATE TABLE parent ( -> id INT(10) NOT NULL PRIMARY KEY, -> column_1 INT(10) NOT NULL, -> column_2 INT(10) NOT NULL, -> column_3 INT(10) NOT NULL, -> column_4 CHAR(10) CHARACTER SET utf8 COLLATE utf8_bin, -> KEY column_2_column_3_idx (column_2, column_3), -> KEY column_4_idx (column_4) -> ) ENGINE INNODB; Query OK, 0 rows affected (0.00 sec) # And now we re-attempt to create the child table mysql> CREATE TABLE child ( -> id INT(10) NOT NULL PRIMARY KEY,drop table child; -> parent_id INT(10), -> FOREIGN KEY (parent_id) REFERENCES "),_("code",[t._v("parent")]),t._v("("),_("code",[t._v("id")]),t._v(") -> ) ENGINE INNODB; Query OK, 0 rows affected (0.01 sec)")])])]),t._v(" "),_("p"),t._v(" "),_("details",[_("summary",[t._v("\n2) 제한사항 참조 내 테이블 혹은 인덱스에 대해 따옴표를 잘못 사용하는 경우\n")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": 각각의 FOREIGN KEY 선언을 살펴보고 객체 수식어 앞뒤로 따옴표가 없는건 아닌지 확인하세요. 혹은 테이블 앞뒤 따옴표와 컬럼 앞뒤로 따옴표가 구별되서 존재하는지 확인하시기 바랍니다.")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 따옴표를 아예 두지 마세요. 또는 테이블 혹은 컬럼에 개별적으로 따옴표를 두시기 바랍니다.")])])]),t._v(" "),_("p"),t._v(" "),_("details",[_("summary",[t._v("\n3) 제한사항 내 로컬 키, 외래 테이블 혹은 컬럼에 오타가 있는 경우")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": SHOW TABLES 및 SHOW COLUMNS를 실행해서 REFERENCES 선언과 비교하세요.")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 오타가 있다면 수정하세요.")])])]),t._v(" "),_("p"),t._v(" "),_("details",[_("summary",[t._v("\n4) 제한사항이 참조하는 컬럼이 외래 컬럼과 동일한 타입 혹은 길이를 갖지 않는 경우\n")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": `SHOW CREATE TABLE parent를 사용해 로컬 컬럼과 참조되는 컬럼 모두 동일한 데이터 타입과 길이를 갖고 있는지 확인하세요.")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 하위 테이블 내 컬럼 정의가 상위 테이블의 정의와 일치하도록 DDL 문을 수정하세요.")])])]),t._v(" "),_("p"),t._v(" "),_("details",[_("summary",[t._v("\n5) 왜래 객체가 어떤 종류의 키도 아닌 경우\n")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": SHOW CREATE TABLE parent를 사용해 REFERENCES 부분이 한 컬럼을 가리키고 있고 그 컬럼이 어떤 식으로든 인덱싱되지 않았는지를 확인합니다.")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 상위 테이블의 컬럼을 KEY, UNIQUE KEY 혹은 PRIMARY KEY로 만듭니다.")])])]),t._v(" "),_("p"),t._v(" "),_("details",[_("summary",[t._v("\n6) 참조된 컬럼이 가장 왼쪽에 있지 않을 때, 외래 키가 멀티 컬럼의 PK 혹은 UK인 경우\n")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": SHOW CREATE TABLE parent를 실행해 REFERENCES 부분이 일부 멀티 컬럼 인덱스 내 컬럼을 가리키고 있을 때 그것의 정의가 가장 왼쪽에 있지 않은지 확인하세요.")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 참조 컬럼이 가장 왼쪽의 (혹은 가장 왼쪽에만 있는) 컬럼인 상위 테이블에 인덱스를 추가하세요.")])])]),t._v(" "),_("p"),t._v(" "),_("details",[_("summary",[t._v("\n7) 두 테이블/컬럼 간에 캐릭터셋/콜레이션이 다른 경우\n")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": SHOW CREATE TABLE parent를 실행하고 하위 컬럼(그리고 테이블)의CHARACTER SET과 COLLATE 부분이 상위 테이블의 것과 일치하는지를 비교하세요.")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 하위 테이블의 DDL을 수정해 상위 테이블 및 컬럼의 캐릭터셋과 콜레이션에 일치시키도록 합니다(또는 하위 테이블이 요구하는 정의대로 상위 테이블을 ALTER합니다).")])])]),t._v(" "),_("p"),t._v(" "),_("details",[_("summary",[t._v("\n8) 상위 테이블이 InnoDB를 사용하고 있지 않은 경우\n")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": SHOW CREATE TABLE parent를 실행하고 ENGINE=INNODB인지 아닌지를 확인합니다.")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 상위 테이블을 ALTER하여 엔진을 InnoDB로 변경하세요.")])])]),t._v(" "),_("p"),t._v(" "),_("details",[_("summary",[t._v("\n9) 외래 키 참조를 위해 문법 숏핸드를 사용하는 경우\n")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": REFERENCE 부분에 테이블 이름만 들어가 있는지를 확인하세요. 이전 동료였던 Bill Karwin이")]),t._v(" "),_("p",[_("a",{attrs:{href:"http://stackoverflow.com/questions/41045234/mysql-error-1215-cannot-add-foreign-key-constraint",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://stackoverflow.com/questions/41045234/mysql-error-1215-cannot-add-foreign-key-constraint"),_("OutboundLink")],1)]),t._v(" "),_("p",[t._v("에서 언급한대로, MySQL은 숏핸드를 지원하지 않습니다(그것이 유효한 SQL일지라도).")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 하위 테이블 DDL을 수정해 테이블과 컬럼 모두 지정하도록 합니다.")])])]),t._v(" "),_("p"),t._v(" "),_("details",[_("summary",[t._v("\n10) 상위 테이블이 파티셔닝된 경우\n")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": SHOW CREATE TABLE parent를 실행해 테이블이 파티셔닝됐는지 아닌지를 확인합니다.")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 파티셔닝 제거(즉, 모든 파티션을 단일 테이블로 합치는 것) 만이 유일한 해결책입니다.")])])]),t._v(" "),_("p"),t._v(" "),_("details",[_("summary",[t._v("\n11) 참조 컬럼이 생성된 가상 컬럼인 경우(이것은 5.7 이상의 버전에서만 가능합니다)\n")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": SHOW CREATE TABLE parent를 실행하고 참조 컬럼이 가상 컬럼이 아닌지 확인합니다.")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 상위 테이블을 CREATE 혹은 ALTER하여 컬럼을 생성이 아니라 저장되도록 만듭니다.")])])]),t._v(" "),_("p"),t._v(" "),_("details",[_("summary",[t._v("\n12) 제한사항 액션을 위해 SET DEFAULT를 사용하는 경우\n")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),_("p",[_("strong",[t._v("진단")])]),t._v(" "),_("p",[t._v(": 하위 테이블 DDL을 확인하여 제한사항 액션(ON DELETE, ON UPDATE)이 SET DEFAULT를 사용하는지 봅니다.")]),t._v(" "),_("p",[_("strong",[t._v("해결")])]),t._v(" "),_("p",[t._v(": 하위 테이블의 CREATE 혹은 ALTER 구문에서 SET DEFAULT를 사용하는 액션을 제거하거나 수정합니다.")])])]),t._v(" "),_("p")])}),[],!1,null,null,null);_.default=a.exports}}]);
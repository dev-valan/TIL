<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mysql[Error:1215] Cannot add foreign key constraint | Valan&#39;s TIL</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/TIL/logo.png">
    <meta name="description" content="Valan&#39;s Log (Today I Learned)">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.4ad97e71.css" as="style"><link rel="preload" href="/TIL/assets/js/app.ea32202d.js" as="script"><link rel="preload" href="/TIL/assets/js/2.0b8dde34.js" as="script"><link rel="preload" href="/TIL/assets/js/14.5ab3600b.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.9966686f.js"><link rel="prefetch" href="/TIL/assets/js/11.eef7ae29.js"><link rel="prefetch" href="/TIL/assets/js/12.e1e63acd.js"><link rel="prefetch" href="/TIL/assets/js/13.a65b0dba.js"><link rel="prefetch" href="/TIL/assets/js/15.46f2dc7b.js"><link rel="prefetch" href="/TIL/assets/js/16.52869930.js"><link rel="prefetch" href="/TIL/assets/js/17.3e327f2c.js"><link rel="prefetch" href="/TIL/assets/js/18.f0b5e0b4.js"><link rel="prefetch" href="/TIL/assets/js/19.d710c287.js"><link rel="prefetch" href="/TIL/assets/js/20.e89790ca.js"><link rel="prefetch" href="/TIL/assets/js/21.02330cd6.js"><link rel="prefetch" href="/TIL/assets/js/22.1b60c654.js"><link rel="prefetch" href="/TIL/assets/js/23.4c926177.js"><link rel="prefetch" href="/TIL/assets/js/24.5af41992.js"><link rel="prefetch" href="/TIL/assets/js/25.357a94e1.js"><link rel="prefetch" href="/TIL/assets/js/26.2a69fb1e.js"><link rel="prefetch" href="/TIL/assets/js/27.13f62791.js"><link rel="prefetch" href="/TIL/assets/js/28.7cb67227.js"><link rel="prefetch" href="/TIL/assets/js/29.ba37903c.js"><link rel="prefetch" href="/TIL/assets/js/3.4213fe6f.js"><link rel="prefetch" href="/TIL/assets/js/30.85134aca.js"><link rel="prefetch" href="/TIL/assets/js/31.29f120f0.js"><link rel="prefetch" href="/TIL/assets/js/32.44492ee3.js"><link rel="prefetch" href="/TIL/assets/js/33.a66110bc.js"><link rel="prefetch" href="/TIL/assets/js/34.7b367621.js"><link rel="prefetch" href="/TIL/assets/js/35.8cafb4d7.js"><link rel="prefetch" href="/TIL/assets/js/36.08aa8131.js"><link rel="prefetch" href="/TIL/assets/js/37.84e47588.js"><link rel="prefetch" href="/TIL/assets/js/38.8f9be0ea.js"><link rel="prefetch" href="/TIL/assets/js/39.05f0a9bc.js"><link rel="prefetch" href="/TIL/assets/js/4.bd33b4e1.js"><link rel="prefetch" href="/TIL/assets/js/40.2c31c75b.js"><link rel="prefetch" href="/TIL/assets/js/41.7d9ace5e.js"><link rel="prefetch" href="/TIL/assets/js/42.c8901358.js"><link rel="prefetch" href="/TIL/assets/js/43.2a460a13.js"><link rel="prefetch" href="/TIL/assets/js/44.94c66b4f.js"><link rel="prefetch" href="/TIL/assets/js/5.378a5792.js"><link rel="prefetch" href="/TIL/assets/js/6.c5a57172.js"><link rel="prefetch" href="/TIL/assets/js/7.01446629.js"><link rel="prefetch" href="/TIL/assets/js/8.0c359314.js"><link rel="prefetch" href="/TIL/assets/js/9.76404eb9.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.4ad97e71.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">Valan's TIL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/dev-valan/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://valan.tistoy.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blogs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/dev-valan/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://valan.tistoy.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blogs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Next.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Debug</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Etc</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/Etc/json_web_token.html" class="sidebar-link">Json Web Token</a></li><li><a href="/TIL/Etc/eslint_build_error.html" class="sidebar-link">빌드 시 ESLint error 무시하기</a></li><li><a href="/TIL/Etc/eslint_quites_setting.html" class="sidebar-link">ESLint 따옴표 설정 변경 (quotes)</a></li><li><a href="/TIL/Etc/mysql_truncate.html" class="sidebar-link">MySQL table truncate</a></li><li><a href="/TIL/Etc/mysql_foreign_key_constraint.html" aria-current="page" class="active sidebar-link">MySQL Cannot add foreign key constraint</a></li><li><a href="/TIL/Etc/mysql_create_user.html" class="sidebar-link">MySQL 계정 생성 및 DB 권한 부여</a></li><li><a href="/TIL/Etc/window_ubuntu.html" class="sidebar-link">윈도우에서 Ubuntu 설치 및 WLS 셋팅</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql-error-1215-cannot-add-foreign-key-constraint"><a href="#mysql-error-1215-cannot-add-foreign-key-constraint" class="header-anchor">#</a> Mysql[Error:1215] Cannot add foreign key constraint</h1> <p align="right">작성일 : 22.08.13</p> <ul><li>외래키 설정 추가 시에 발생하는 문제점</li> <li>명확하게 뭐가 잘못되서 외래키를 추가할 수 없는지 표시해주지 않음.</li> <li>여러가지 상황을 다 고려해봐야 함.</li> <li>내 경우에는 4번과 5번이 같이 문제였음.</li> <li>8번의 case도 생겼다. 영카트 기반으로 짜여진 DB에서 table 새로 만들었을때 innodb가 아닌 MyISAM 인 경우도 있다...</li> <li>언어 인코딩 설정도 동일해야한다 ( ex: utf8_general_ci 와 utfmb4_general_ci 는 안된다.)</li></ul> <a href="https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&amp;blogId=apple_ar&amp;logNo=221404069733">
참고
</a> <hr> <details><summary>
1) 제한사항이 참조하는 테이블 혹은 인덱스가 아직 존재하지 않는 경우(보통 덤프를 로드하는 경우)
</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: 각 상위 테이블에 대해 SHOW TABLES 혹은 SHOW CREATE TABLE을 실행하세요. 어느 것이든 1146 오류가 난다면, 잘못된 순서로 생성하고 있다는 것을 의미합니다.</p> <p><strong>해결</strong></p> <p>: 누락된 create table을 실행하고 나서 다시 시도해보거나 foreign-key-checks를 잠시 비활성화하세요. 특히 순환 참조가 존재할 수도 있는 데이터베이스를 백업으로 복구하는 동안 필요합니다. 다음처럼 실행하세요:</p> <p>SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS; SET FOREIGN_KEY_CHECKS=0; SOURCE /backups/mydump.sql; -- restore your backup within THIS session SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;</p> <p><strong>예제</strong></p> <p>:</p> <p>mysql&gt; CREATE TABLE child ( -&gt; id INT(10) NOT NULL PRIMARY KEY, -&gt; parent_id INT(10), -&gt; FOREIGN KEY (parent_id) REFERENCES <code>parent</code>(<code>id</code>) -&gt; ) ENGINE INNODB; ERROR 1215 (HY000): Cannot add foreign key constraint # We check for the parent table and is not there. mysql&gt; SHOW TABLES LIKE 'par%'; Empty set (0.00 sec) # We go ahead and create the parent table (we’ll use the same parent table structure for all other example in this blogpost): mysql&gt; CREATE TABLE parent ( -&gt; id INT(10) NOT NULL PRIMARY KEY, -&gt; column_1 INT(10) NOT NULL, -&gt; column_2 INT(10) NOT NULL, -&gt; column_3 INT(10) NOT NULL, -&gt; column_4 CHAR(10) CHARACTER SET utf8 COLLATE utf8_bin, -&gt; KEY column_2_column_3_idx (column_2, column_3), -&gt; KEY column_4_idx (column_4) -&gt; ) ENGINE INNODB; Query OK, 0 rows affected (0.00 sec) # And now we re-attempt to create the child table mysql&gt; CREATE TABLE child ( -&gt; id INT(10) NOT NULL PRIMARY KEY,drop table child; -&gt; parent_id INT(10), -&gt; FOREIGN KEY (parent_id) REFERENCES <code>parent</code>(<code>id</code>) -&gt; ) ENGINE INNODB; Query OK, 0 rows affected (0.01 sec)</p></div></details> <p></p> <details><summary>
2) 제한사항 참조 내 테이블 혹은 인덱스에 대해 따옴표를 잘못 사용하는 경우
</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: 각각의 FOREIGN KEY 선언을 살펴보고 객체 수식어 앞뒤로 따옴표가 없는건 아닌지 확인하세요. 혹은 테이블 앞뒤 따옴표와 컬럼 앞뒤로 따옴표가 구별되서 존재하는지 확인하시기 바랍니다.</p> <p><strong>해결</strong></p> <p>: 따옴표를 아예 두지 마세요. 또는 테이블 혹은 컬럼에 개별적으로 따옴표를 두시기 바랍니다.</p></div></details> <p></p> <details><summary>
3) 제한사항 내 로컬 키, 외래 테이블 혹은 컬럼에 오타가 있는 경우</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: SHOW TABLES 및 SHOW COLUMNS를 실행해서 REFERENCES 선언과 비교하세요.</p> <p><strong>해결</strong></p> <p>: 오타가 있다면 수정하세요.</p></div></details> <p></p> <details><summary>
4) 제한사항이 참조하는 컬럼이 외래 컬럼과 동일한 타입 혹은 길이를 갖지 않는 경우
</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: `SHOW CREATE TABLE parent를 사용해 로컬 컬럼과 참조되는 컬럼 모두 동일한 데이터 타입과 길이를 갖고 있는지 확인하세요.</p> <p><strong>해결</strong></p> <p>: 하위 테이블 내 컬럼 정의가 상위 테이블의 정의와 일치하도록 DDL 문을 수정하세요.</p></div></details> <p></p> <details><summary>
5) 왜래 객체가 어떤 종류의 키도 아닌 경우
</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: SHOW CREATE TABLE parent를 사용해 REFERENCES 부분이 한 컬럼을 가리키고 있고 그 컬럼이 어떤 식으로든 인덱싱되지 않았는지를 확인합니다.</p> <p><strong>해결</strong></p> <p>: 상위 테이블의 컬럼을 KEY, UNIQUE KEY 혹은 PRIMARY KEY로 만듭니다.</p></div></details> <p></p> <details><summary>
6) 참조된 컬럼이 가장 왼쪽에 있지 않을 때, 외래 키가 멀티 컬럼의 PK 혹은 UK인 경우
</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: SHOW CREATE TABLE parent를 실행해 REFERENCES 부분이 일부 멀티 컬럼 인덱스 내 컬럼을 가리키고 있을 때 그것의 정의가 가장 왼쪽에 있지 않은지 확인하세요.</p> <p><strong>해결</strong></p> <p>: 참조 컬럼이 가장 왼쪽의 (혹은 가장 왼쪽에만 있는) 컬럼인 상위 테이블에 인덱스를 추가하세요.</p></div></details> <p></p> <details><summary>
7) 두 테이블/컬럼 간에 캐릭터셋/콜레이션이 다른 경우
</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: SHOW CREATE TABLE parent를 실행하고 하위 컬럼(그리고 테이블)의CHARACTER SET과 COLLATE 부분이 상위 테이블의 것과 일치하는지를 비교하세요.</p> <p><strong>해결</strong></p> <p>: 하위 테이블의 DDL을 수정해 상위 테이블 및 컬럼의 캐릭터셋과 콜레이션에 일치시키도록 합니다(또는 하위 테이블이 요구하는 정의대로 상위 테이블을 ALTER합니다).</p></div></details> <p></p> <details><summary>
8) 상위 테이블이 InnoDB를 사용하고 있지 않은 경우
</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: SHOW CREATE TABLE parent를 실행하고 ENGINE=INNODB인지 아닌지를 확인합니다.</p> <p><strong>해결</strong></p> <p>: 상위 테이블을 ALTER하여 엔진을 InnoDB로 변경하세요.</p></div></details> <p></p> <details><summary>
9) 외래 키 참조를 위해 문법 숏핸드를 사용하는 경우
</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: REFERENCE 부분에 테이블 이름만 들어가 있는지를 확인하세요. 이전 동료였던 Bill Karwin이</p> <p><a href="http://stackoverflow.com/questions/41045234/mysql-error-1215-cannot-add-foreign-key-constraint" target="_blank" rel="noopener noreferrer">http://stackoverflow.com/questions/41045234/mysql-error-1215-cannot-add-foreign-key-constraint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>에서 언급한대로, MySQL은 숏핸드를 지원하지 않습니다(그것이 유효한 SQL일지라도).</p> <p><strong>해결</strong></p> <p>: 하위 테이블 DDL을 수정해 테이블과 컬럼 모두 지정하도록 합니다.</p></div></details> <p></p> <details><summary>
10) 상위 테이블이 파티셔닝된 경우
</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: SHOW CREATE TABLE parent를 실행해 테이블이 파티셔닝됐는지 아닌지를 확인합니다.</p> <p><strong>해결</strong></p> <p>: 파티셔닝 제거(즉, 모든 파티션을 단일 테이블로 합치는 것) 만이 유일한 해결책입니다.</p></div></details> <p></p> <details><summary>
11) 참조 컬럼이 생성된 가상 컬럼인 경우(이것은 5.7 이상의 버전에서만 가능합니다)
</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: SHOW CREATE TABLE parent를 실행하고 참조 컬럼이 가상 컬럼이 아닌지 확인합니다.</p> <p><strong>해결</strong></p> <p>: 상위 테이블을 CREATE 혹은 ALTER하여 컬럼을 생성이 아니라 저장되도록 만듭니다.</p></div></details> <p></p> <details><summary>
12) 제한사항 액션을 위해 SET DEFAULT를 사용하는 경우
</summary> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>진단</strong></p> <p>: 하위 테이블 DDL을 확인하여 제한사항 액션(ON DELETE, ON UPDATE)이 SET DEFAULT를 사용하는지 봅니다.</p> <p><strong>해결</strong></p> <p>: 하위 테이블의 CREATE 혹은 ALTER 구문에서 SET DEFAULT를 사용하는 액션을 제거하거나 수정합니다.</p></div></details> <p></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TIL/Etc/mysql_truncate.html" class="prev">
        MySQL table truncate
      </a></span> <span class="next"><a href="/TIL/Etc/mysql_create_user.html">
        MySQL 계정 생성 및 DB 권한 부여
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.ea32202d.js" defer></script><script src="/TIL/assets/js/2.0b8dde34.js" defer></script><script src="/TIL/assets/js/14.5ab3600b.js" defer></script>
  </body>
</html>
